<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <title> | Database Storage</title>
    
    <link rel="stylesheet" href="https://sdttttt.github.io/style.css?h=a56f213afcf5d255b64918e7a9e0f468ef1d0ac2954b49f36003998666482371">
    
</head>
<body>
    
<header class="space">
    <a href="https:&#x2F;&#x2F;sdttttt.github.io">&LeftArrow; Home</a>
</header>

    
<main>
    <h1>Database Storage</h1>
    
    <p class="secondary">2 June, 2020</p>
    
    <div class="space"></div>
    <p><strong>CMU Database System 15-445/645</strong> 储存 Part 1</p>
<p>数据库存储的数据在 FS(File System) 中是以 <strong>块(Block)</strong> 的方式表示的.</p>
<p>实际上你很可能已经见到过了,在MySQL中的数据库就是以一切Block文件的方式存储的.</p>
<p>这篇文章会告诉你目前常见的数据库存储方式.</p>
<hr />
<p>最开始用<strong>Tuple Storage</strong>来尝试改善数据库的存储结构.</p>
<p><img src="https://imgkr.cn-bj.ufileos.com/0029ea52-6d5b-4989-a8e0-a7dec2e0d49c.png" alt="" /></p>
<p>它的工作原理比较简单, 每一个<strong>Page</strong>维护一个<strong>Header</strong>,
Header中会包含一些Page的元数据,以及被存储数据的偏移值.</p>
<p>每当插入一个Tuple,我们就会Update Header中的偏移值.</p>
<p>这个设计中存在比较大的问题, 如果我们删除了底下Tuple,就不得不移动所有Tuple.
如果不移动数据, 那我们也要花费高昂的代价去维护Header中Page的meta数据.</p>
<hr />
<p>目前最常见的就是<strong>Slotted Pages</strong>的方式去存储数据.
在不同数据库中的实现细节可能不同,但是从高级层面来讲,大多数数据库系统,
用的都是这种方式去存储数据.</p>
<p><img src="https://imgkr.cn-bj.ufileos.com/a47909a8-e0e6-48ea-a0b7-e3e327d7fdf2.png" alt="" /></p>
<p>每个Page中有三个部分:</p>
<ul>
<li><strong>Header</strong>: 保存最基本的matedata, 还包含一些checksum和访问时间之类的.</li>
<li><strong>SlotArray</strong>: 将每一个特定的Slot映射到对应Tuple的偏移值上.</li>
<li><strong>TupleArray</strong>: 储存每一个Tuple.</li>
</ul>
<p>在这个结构中Header后面紧接这SoltArray, 而Tuple是从Page的尾部开始存储的.
每个Page存储的Tuple的个数是固定的.</p>
<p>如果Tuple被删除,我们也只需要删除固定的Solt就行. 
空出来的空间碎片,可以由数据库的空间整理功能去完成.
维护每个Tuple的成本也比较小.只需要改变Solt就可以.</p>
<hr />
<p>最后讲一个Demo来演示数据库的工作过程.</p>
<p>假如我想要找一个叫A的人,我会先去查找索引.
从索引里我知道A的Page是123, Solt是2.
我去找管理Pages的人,让他把Page123的指针给我,
然后拿着Page的指针,找到Solt2中的偏移地址,找到了A这个人.</p>

</main>

    <div class="dark-mode-buttons">
        <button class="dark-mode-button" id="dark-mode-on"><img src="https://sdttttt.github.io/dark_mode.svg" width="24" height="24" alt="Dark mode" aria-label="dark mode toggle" title="Dark mode"></button>
        <button class="dark-mode-button" id="dark-mode-off"><img src="https://sdttttt.github.io/light_mode.svg" width="24" height="24" alt="Light mode" aria-label="light mode toggle" title="Light mode"></button>
    </div>
    <script>
        const cls = document.body.classList;
        const getSessionTheme = sessionStorage.getItem("theme");
        if (getSessionTheme === "dark") {
            cls.toggle("dark-mode", true);
        } else if (getSessionTheme === "light") {
            cls.toggle("dark-mode", false);
        } else if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
            cls.toggle("dark-mode", true);
        }

        document.getElementById("dark-mode-on").addEventListener("click", function(e) {
            cls.toggle("dark-mode", true);
            sessionStorage.setItem("theme", "dark");
        });
        document.getElementById("dark-mode-off").addEventListener("click", function(e) {
            cls.toggle("dark-mode", false);
            sessionStorage.setItem("theme", "light");
        });
    </script>
    <noscript>
        <style>
            .dark-mode-buttons {
                display: none;
            }
        </style>
    </noscript>
</body>
</html>
